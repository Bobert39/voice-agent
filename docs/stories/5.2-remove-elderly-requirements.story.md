# Story 5.2: Remove Elderly-Specific Requirements - Brownfield Simplification

## User Story

As a **Product Owner**,
I want **to remove all elderly-specific features and optimizations from the codebase**,
So that **the system is simplified, maintainable, and focused on serving all users equally**.

## Story Context

**Existing System Integration:**
- Integrates with: All 9 microservices in the monorepo
- Technology: TypeScript, Node.js, NLU services, TTS configuration
- Follows pattern: Existing service architecture and communication patterns
- Touch points: 47 files with 200+ elderly-specific references

## Current Implementation Scope

### Files Requiring Complete Deletion (3 files)
1. `packages/nlu-service/src/services/elderly-optimization-service.ts` - 357 lines
2. `packages/practice-info-service/src/__tests__/elderly-accessibility.test.ts` - 238 lines
3. `docs/elderly-specific-accessibility-testing-framework.md` - 1000+ lines

### Files Requiring Major Updates (5 files, 10+ references each)
1. `packages/voice-ai-service/src/services/nlu/naturalLanguageService.ts` - 24 references
2. `packages/scheduling-service/src/services/appointment-reminder-service.ts` - 16 references
3. `docs/development-deployment-checklist.md` - 15 references
4. `docs/project-completion-summary.md` - 10 references
5. `docs/stories/1.4.story.md` - 10 references

### Files Requiring Minor Updates (39 files, 1-9 references each)
- NLU services: 8 files
- Scheduling services: 6 files
- Conversation services: 5 files
- Test files: 12 files
- Documentation: 8 files

## Acceptance Criteria

### Functional Requirements:

1. **Complete removal of elderly-specific code**
   - No references to elderly, senior, geriatric, or age-specific optimizations
   - Environment variable ELDERLY_MODE_ENABLED removed
   - All age-based conditional logic eliminated

2. **Standard voice configuration for all users**
   - Speech rate: 1.0 (standard speed)
   - Stability: 0.5 (standard setting)
   - Similarity boost: 0.75 (standard setting)
   - No age-based branching in conversation flows

3. **Simplified NLU processing**
   - Remove elderly-specific prompt engineering
   - Standard timeout values for all users
   - Uniform intent recognition patterns

### Integration Requirements:

4. Core conversation flows work without elderly optimizations
5. All microservices communicate successfully after changes
6. Existing non-elderly functionality remains unchanged
7. Performance meets or exceeds current benchmarks

### Quality Requirements:

8. Zero references to elderly-specific features in codebase
9. All tests updated and passing (maintaining ≥80% coverage)
10. Documentation reflects unified user approach
11. No regression in core functionality

## Technical Implementation Details

### 1. Remove Elderly Service & Dependencies
```bash
# Delete the elderly optimization service
rm packages/nlu-service/src/services/elderly-optimization-service.ts

# Remove from NLU service exports
# Update packages/nlu-service/src/index.ts to remove elderly service export
```

### 2. Update Voice Configuration
```typescript
// packages/voice-ai-service/src/services/audio/audioProcessingService.ts
// BEFORE:
const voiceSettings = {
  stability: isElderly ? 0.8 : 0.5,
  similarity_boost: isElderly ? 0.6 : 0.75,
  speed: isElderly ? 0.8 : 1.0
};

// AFTER:
const voiceSettings = {
  stability: 0.5,
  similarity_boost: 0.75,
  speed: 1.0
};
```

### 3. Simplify NLU Processing
```typescript
// packages/voice-ai-service/src/services/nlu/naturalLanguageService.ts
// Remove all elderly-specific optimizations:
// - Remove elderly mode checks
// - Remove age-based prompt modifications
// - Remove extended timeout logic
// - Standardize response formatting
```

### 4. Update Conversation Flows
```typescript
// Remove elderly detection and branching from:
// - conversationManager.ts
// - nluIntegration.ts
// - appointmentConfirmationIntegration.ts
// - enhancedCancellationIntegration.ts
```

### 5. Update Tests
```typescript
// Update test descriptions and expectations
// FROM: describe('Elderly patient conversation flow')
// TO: describe('Patient conversation flow')

// Remove elderly-specific test cases
// Update assertions to expect standard behavior
```

## Implementation Checklist

### Pre-Implementation Verification
- [ ] Build system fixes completed (Story 5.1)
- [ ] All services compiling successfully
- [ ] Current tests passing

### Code Changes
- [ ] Delete 3 elderly-specific files
- [ ] Update 5 major files (10+ references)
- [ ] Update 39 minor files (1-9 references)
- [ ] Remove ELDERLY_MODE environment variable
- [ ] Update all import statements

### Documentation Updates
- [ ] Update PRD user personas
- [ ] Update architecture diagrams
- [ ] Remove elderly-specific testing docs
- [ ] Update API documentation
- [ ] Update deployment guides

### Testing Updates
- [ ] Remove elderly-specific test files
- [ ] Update test descriptions
- [ ] Verify standard voice settings
- [ ] Confirm no age-based branching
- [ ] Regression test all flows

## Definition of Done

- [ ] Zero grep results for "elderly|senior|geriatric" in source code
- [ ] All services compile without errors
- [ ] All tests updated and passing
- [ ] Code coverage maintained ≥80%
- [ ] Performance benchmarks met
- [ ] Documentation updated
- [ ] No functional regressions
- [ ] Code review completed
- [ ] Merged to main branch

## Risk Mitigation

**Primary Risk:** Accidentally removing non-elderly functionality
- **Mitigation:** Careful code review of each change
- **Validation:** Comprehensive regression testing

**Secondary Risk:** Missing elderly references causing runtime errors
- **Mitigation:** Systematic grep searches before completion
- **Validation:** End-to-end testing of all flows

**Rollback Plan:**
- Feature branch approach
- Git revert if issues discovered
- Maintain backup of deleted files temporarily

## Validation Commands

```bash
# Verify complete removal
grep -r "elderly\|senior\|geriatric" --include="*.ts" --include="*.js" packages/
# Expected: 0 results

# Check environment variables
grep -r "ELDERLY_MODE" . --exclude-dir=node_modules
# Expected: 0 results

# Run tests
npm test
# Expected: All pass

# Check coverage
npm test -- --coverage
# Expected: ≥80% coverage maintained
```

## Success Metrics
- Zero elderly-specific code references ✅
- All tests passing ✅
- Coverage ≥80% maintained ✅
- Performance unchanged or improved ✅
- All users treated equally ✅

**Estimated Time:** 2 days of focused development